<!-- Componente de la barra de navegación del administrador -->
<app-barra-navegacion-admin></app-barra-navegacion-admin>

<!-- Título de la página -->
<h2 class="table-title">Lista de Usuarios</h2>

<!-- Descripción de la funcionalidad -->
<p class="table-description">
  Aquí puedes gestionar todos los usuarios registrados en la plataforma (Administradores, Veterinarios y Pacientes). Puedes agregar nuevos usuarios, editar información existente o gestionar cuentas.
</p>

<!-- ===== BOTÓN PARA AGREGAR VETERINARIO ===== -->
<div class="btn-container">
  <button type="button" class="btn-action btn-edit btn-agregar" (click)="abrirModalIngresar()">
    <i class="fa-solid fa-user-plus"></i> Ingresar Usuario
  </button>
</div>

<!-- Mensaje de carga -->
<div *ngIf="cargando" style="text-align: center; padding: 20px; color: #20B2AA;">
  <i class="fa-solid fa-spinner fa-spin" style="font-size: 24px;"></i>
  <p>Cargando usuarios...</p>
</div>

<!-- ===== TABLA DE VETERINARIOS ===== -->
<table class="custom-table" *ngIf="!cargando">
  <!-- Encabezados de la tabla -->
  <thead>
    <tr>
      <th class="col-nombre">Nombre</th>
      <th class="col-apellido">Apellido</th>
      <th class="col-edad">Edad</th>
      <th class="col-correo">Correo Electrónico</th>
      <th class="col-tipo">Tipo</th>
      <th class="col-estado">Estado</th>
      <th class="col-acciones">Acciones</th>
    </tr>
  </thead>

  <!-- Cuerpo de la tabla con datos dinámicos -->
  <tbody>
    <tr *ngFor="let veterinario of veterinarios; let i = index" [style.opacity]="veterinario.activo ? '1' : '0.6'">
      <td class="col-nombre">{{ veterinario.nombre }}</td>
      <td class="col-apellido">{{ veterinario.apellido }}</td>
      <td class="col-edad">{{ veterinario.edad }}</td>
      <td class="col-correo">{{ veterinario.correo }}</td>
      
      <!-- Tipo de usuario -->
      <td class="col-tipo">
        <span *ngIf="veterinario.tipoUsuario === 'admin'" style="background: #007bff; color: white; padding: 4px 12px; border-radius: 12px; font-size: 0.85rem; font-weight: 600;">
          <i class="fa-solid fa-user-shield"></i> Admin
        </span>
        <span *ngIf="veterinario.tipoUsuario === 'veterinario'" style="background: #28a745; color: white; padding: 4px 12px; border-radius: 12px; font-size: 0.85rem; font-weight: 600;">
          <i class="fa-solid fa-user-doctor"></i> Veterinario
        </span>
        <span *ngIf="veterinario.tipoUsuario === 'paciente'" style="background: #6c757d; color: white; padding: 4px 12px; border-radius: 12px; font-size: 0.85rem; font-weight: 600;">
          <i class="fa-solid fa-user"></i> Paciente
        </span>
      </td>
      
      <!-- Estado del usuario -->
      <td class="col-estado">
        <span *ngIf="veterinario.activo" style="color: #28a745; font-weight: bold;">
          <i class="fa-solid fa-check-circle"></i> Activo
        </span>
        <span *ngIf="!veterinario.activo" style="color: #dc3545; font-weight: bold;">
          <i class="fa-solid fa-times-circle"></i> Inactivo
        </span>
      </td>
      
      <!-- Columna con botones de acción -->
      <td class="col-acciones">
        <!-- Botón EDITAR -->
        <button class="btn-action btn-edit" (click)="abrirModalEditar(veterinario, i)" [disabled]="cargando">
          <i class="fa-solid fa-pen-to-square"></i> Editar
        </button>
        
        <!-- Botón ACTIVAR/DESACTIVAR -->
        <button 
          class="btn-action" 
          [class.btn-disable]="veterinario.activo"
          [class.btn-activate]="!veterinario.activo"
          (click)="toggleDesactivar(i)" 
          [disabled]="cargando">
          <i class="fa-solid" [class.fa-ban]="veterinario.activo" [class.fa-check]="!veterinario.activo"></i>
          {{ veterinario.activo ? 'Desactivar' : 'Activar' }}
        </button>
        
        <!-- Botón ELIMINAR -->
        <button class="btn-action btn-delete" (click)="eliminarVeterinario(i)" [disabled]="cargando">
          <i class="fa-solid fa-trash"></i> Eliminar
        </button>
      </td>
    </tr>
  </tbody>
</table>

<!-- Mensaje cuando no hay usuarios -->
<div *ngIf="!cargando && veterinarios.length === 0" style="text-align: center; padding: 40px; color: #666;">
  <i class="fa-solid fa-users-slash" style="font-size: 48px; color: #ddd;"></i>
  <p style="margin-top: 20px; font-size: 18px;">No hay usuarios registrados</p>
  <p style="color: #999;">Haz clic en "Ingresar Veterinario" para agregar uno nuevo</p>
</div>

<!-- ========== MODAL INGRESAR VETERINARIO ========== -->
<!-- 
  *ngIf: Solo se muestra cuando mostrarModalIngresar es true
  (click): Cierra el modal si se hace clic en el fondo oscuro
-->
<div class="modal-overlay" *ngIf="mostrarModalIngresar" (click)="cerrarModalIngresar()">
  <!-- 
    $event.stopPropagation(): Evita que el clic dentro del modal lo cierre
    Permite interactuar con el contenido sin cerrar el modal
  -->
  <div class="modal-content" (click)="$event.stopPropagation()">
    <!-- Encabezado del modal con título y botón cerrar -->
    <div class="modal-header">
      <h2><i class="fa-solid fa-user-plus"></i> Ingresar Nuevo Usuario</h2>
      <button class="btn-close" (click)="cerrarModalIngresar()">&times;</button>
    </div>

    <!-- Formulario del modal -->
    <form class="modal-body">
      <!-- ===== SECCIÓN: Tipo de Usuario ===== -->
      <div class="seccion">
        <h3><i class="fa-solid fa-user-tag"></i> Tipo de Usuario</h3>
        <div class="form-row">
          <div class="form-group">
            <label>Tipo de Usuario *</label>
            <select [(ngModel)]="nuevoVeterinario.tipoUsuario" name="tipoUsuario" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
              <option value="veterinario">Veterinario</option>
              <option value="admin">Administrador</option>
            </select>
          </div>
        </div>
      </div>

      <!-- ===== SECCIÓN: Información Personal ===== -->
      <div class="seccion">
        <h3><i class="fa-solid fa-id-card"></i> Información Personal</h3>
        <div class="form-row">
          <div class="form-group">
            <label>Nombre *</label>
            <!-- 
              [(ngModel)]: Two-way data binding
              Vincula el input con nuevoVeterinario.nombre
              Los cambios se reflejan automáticamente
            -->
            <input type="text" [(ngModel)]="nuevoVeterinario.nombre" name="nombre" placeholder="Nombre" required>
          </div>
          <div class="form-group">
            <label>Apellido *</label>
            <input type="text" [(ngModel)]="nuevoVeterinario.apellido" name="apellido" placeholder="Apellido" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Edad</label>
            <input type="number" [(ngModel)]="nuevoVeterinario.edad" name="edad" placeholder="Edad">
          </div>
        </div>
      </div>

      <!-- ===== SECCIÓN: Información de Contacto ===== -->
      <div class="seccion">
        <h3><i class="fa-solid fa-address-book"></i> Información de Contacto</h3>
        <div class="form-row">
          <div class="form-group">
            <label>Correo Electrónico *</label>
            <!-- type="email": Validación automática de formato de correo -->
            <input type="email" [(ngModel)]="nuevoVeterinario.correo" name="correo" placeholder="usuario@gmail.com, usuario@veterinario.com o usuario@littlefalls.com" required>
          </div>
        </div>
      </div>

      <!-- ===== SECCIÓN: Seguridad ===== -->
      <div class="seccion">
        <h3><i class="fa-solid fa-lock"></i> Seguridad</h3>
        <div class="form-row">
          <div class="form-group">
            <label>Contraseña *</label>
            <div class="password-input-container">
              <input 
                [type]="mostrarPassword ? 'text' : 'password'" 
                [(ngModel)]="nuevoVeterinario.password" 
                name="password" 
                placeholder="Solo letras y números" 
                required>
              <button type="button" class="btn-toggle-password" (click)="togglePasswordVisibility()">
                <i class="fa-solid" [class.fa-eye]="mostrarPassword" [class.fa-eye-slash]="!mostrarPassword"></i>
              </button>
            </div>
          </div>
          <div class="form-group">
            <label>Confirmar Contraseña *</label>
            <div class="password-input-container">
              <input 
                [type]="mostrarConfirmPassword ? 'text' : 'password'" 
                [(ngModel)]="nuevoVeterinario.confirmPassword" 
                name="confirmPassword" 
                placeholder="Repita la contraseña (solo letras y números)" 
                required>
                placeholder="Repita la contraseña" 
                required>
              <button type="button" class="btn-toggle-password" (click)="toggleConfirmPasswordVisibility()">
                <i class="fa-solid" [class.fa-eye]="mostrarConfirmPassword" [class.fa-eye-slash]="!mostrarConfirmPassword"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </form>

    <!-- Pie del modal con botones -->
    <div class="modal-footer">
      <button class="btn-cancelar" (click)="cerrarModalIngresar()">Cancelar</button>
      <!-- 
        Al hacer clic en Guardar:
        1. Se validan los campos obligatorios
        2. Se agrega el veterinario al array
        3. La tabla se actualiza automáticamente
      -->
      <button class="btn-guardar" (click)="guardarNuevoVeterinario()">
        <i class="fa-solid fa-floppy-disk"></i> Guardar Veterinario
      </button>
    </div>
  </div>
</div>

<!-- ========== MODAL EDITAR VETERINARIO ========== -->
<!-- 
  *ngIf: Solo se muestra cuando mostrarModalEditar es true
  Modal más compacto para edición rápida
  Usa veterinarioEditar en lugar de nuevoVeterinario
  Pre-carga datos del veterinario seleccionado
-->
<div class="modal-overlay" *ngIf="mostrarModalEditar" (click)="cerrarModalEditar()">
  <!-- modal-editar: Clase adicional para estilo más compacto (max-width: 650px) -->
  <div class="modal-content modal-editar" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2><i class="fa-solid fa-pen-to-square"></i> Editar Veterinario</h2>
      <button class="btn-close" (click)="cerrarModalEditar()">&times;</button>
    </div>

    <form class="modal-body">
      <!-- ===== SECCIÓN: Información Personal ===== -->
      <div class="seccion">
        <h3><i class="fa-solid fa-id-card"></i> Información Personal</h3>
        <div class="form-row">
          <div class="form-group">
            <label>Nombre *</label>
            <!-- 
              veterinarioEditar: Contiene la copia del veterinario seleccionado
              Los cambios no afectan la tabla hasta presionar "Guardar Cambios"
            -->
            <input type="text" [(ngModel)]="veterinarioEditar.nombre" name="nombre" placeholder="Nombre" required>
          </div>
          <div class="form-group">
            <label>Apellido *</label>
            <input type="text" [(ngModel)]="veterinarioEditar.apellido" name="apellido" placeholder="Apellido" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Edad</label>
            <input type="number" [(ngModel)]="veterinarioEditar.edad" name="edad" placeholder="Edad">
          </div>
        </div>
      </div>

      <!-- ===== SECCIÓN: Información de Contacto ===== -->
      <div class="seccion">
        <h3><i class="fa-solid fa-address-book"></i> Información de Contacto</h3>
        <div class="form-row">
          <div class="form-group">
            <label>Correo Electrónico *</label>
            <input type="email" [(ngModel)]="veterinarioEditar.correo" name="correo" placeholder="usuario@gmail.com, usuario@veterinario.com o usuario@littlefalls.com" required>
          </div>
        </div>
      </div>

      <!-- ===== SECCIÓN: Seguridad (Opcional) ===== -->
      <div class="seccion">
        <h3><i class="fa-solid fa-lock"></i> Cambiar Contraseña (Opcional)</h3>
        <div class="form-row">
          <div class="form-group">
            <label>Nueva Contraseña</label>
            <div class="password-input-container">
              <input 
                [type]="mostrarPassword ? 'text' : 'password'" 
                [(ngModel)]="veterinarioEditar.password" 
                name="passwordEdit" 
                placeholder="Dejar en blanco para no cambiar">
              <button type="button" class="btn-toggle-password" (click)="togglePasswordVisibility()">
                <i class="fa-solid" [class.fa-eye]="mostrarPassword" [class.fa-eye-slash]="!mostrarPassword"></i>
              </button>
            </div>
          </div>
          <div class="form-group">
            <label>Confirmar Nueva Contraseña</label>
            <div class="password-input-container">
              <input 
                [type]="mostrarConfirmPassword ? 'text' : 'password'" 
                [(ngModel)]="veterinarioEditar.confirmPassword" 
                name="confirmPasswordEdit" 
                placeholder="Repetir nueva contraseña">
              <button type="button" class="btn-toggle-password" (click)="toggleConfirmPasswordVisibility()">
                <i class="fa-solid" [class.fa-eye]="mostrarConfirmPassword" [class.fa-eye-slash]="!mostrarConfirmPassword"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </form>

    <!-- Pie del modal con botones -->
    <div class="modal-footer">
      <button class="btn-cancelar" (click)="cerrarModalEditar()">Cancelar</button>
      <!-- 
        Al guardar cambios:
        1. veterinarioEditar se copia de vuelta al array en la posición indiceEditando
        2. La tabla se actualiza mostrando los nuevos datos
      -->
      <button class="btn-guardar" (click)="guardarEdicion()">
        <i class="fa-solid fa-check"></i> Guardar Cambios
      </button>
    </div>
  </div>
</div>
